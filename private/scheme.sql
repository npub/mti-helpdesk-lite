CREATE TABLE tickets (id INT UNSIGNED AUTO_INCREMENT NOT NULL COMMENT 'ID заявки', version INT UNSIGNED DEFAULT 1 NOT NULL COMMENT 'Версия', title VARCHAR(200) NOT NULL COMMENT 'Название', description LONGTEXT NOT NULL COMMENT 'Описание', author_email VARCHAR(255) NOT NULL COMMENT 'Email автора', status ENUM('new', 'in_progress', 'done', 'closed') DEFAULT 'new' NOT NULL COMMENT 'Статус', created_at DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT 'Дата создания', updated_at DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT 'Дата обновления', INDEX idx_tickets_status_created (status, created_at), INDEX idx_tickets_updated (updated_at), PRIMARY KEY (id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` COMMENT = 'Заявки' ;

CREATE TABLE ticket_comments (id INT UNSIGNED AUTO_INCREMENT NOT NULL COMMENT 'ID комментария', author VARCHAR(100) NOT NULL COMMENT 'Автор', message LONGTEXT NOT NULL COMMENT 'Сообщение', created_at DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT 'Дата создания', ticket_id INT UNSIGNED NOT NULL COMMENT 'ID заявки', INDEX IDX_DAF76AAB700047D2 (ticket_id), INDEX idx_comments_ticket_created (ticket_id, created_at), PRIMARY KEY (id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` COMMENT = 'Комментарии к заявкам' ;

ALTER TABLE ticket_comments ADD CONSTRAINT FK_DAF76AAB700047D2 FOREIGN KEY (ticket_id) REFERENCES tickets (id) ON DELETE CASCADE;
